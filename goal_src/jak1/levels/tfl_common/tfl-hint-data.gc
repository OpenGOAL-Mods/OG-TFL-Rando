;;-*-Lisp-*-
(in-package goal)

(deftype tfl-hint-data (structure)
  ((file-name string) ;; file name (with extension)
   (alt-names (array string)) ;; alternate files to play, picked at random
   (text-id text-id) ;; used to mark the hint as seen
   (voicebox? symbol) ;; whether to spawn the communicator for this hint
   (interrupt? symbol) ;; can this hint be interrupted by another one?
   (repeat? symbol) ;; whether to repeat the hint
   (repeat-delay time-frame) ;; how long to wait before repeating
   (task-status task-status) ;; only play if the hint's task is in this state (closed, need-resolution, etc.)
   (force-playback? symbol) ;; whether to play regardless of play-hints setting
   (target-mode pair) ;; only play if jak is in a specific mode (empty list to ignore)
   (close-task game-task) ;; close this specific task after playing the hint ((game-task none) to ignore)
   )
  )

#|
target-mode syntax:
car can be mode, powerup, anim
valid cadr for mode:
racer, flut
valid cadr for powerup:
eco-blue, eco-red, eco-green, eco-yellow,
super-eco-blue, super-eco-red, super-eco-green, super-eco-yellow
valid cadr for anim:
any eichar anim, also takes a cddr of anim channel idx, #f for any channel

examples:
'(mode flut)
'(mode racer)
'(powerup super-eco-red)
'(anim eichar-launch-jump #f)
'(anim eichar-stance-loop 0)
|#

(defmacro static-hint-data (&key file-name
                            &key (alt-names (new 'static 'boxed-array :type string))
                            &key (text-id (text-id zero))
                            &key (voicebox? #f)
                            &key (interrupt? #f)
                            &key (repeat? #f)
                            &key (repeat-delay (seconds 0))
                            &key (task-status (task-status invalid))
                            &key (force-playback? #f)
                            &key (target-mode '())
                            &key (close-task (game-task none)))
  `(new 'static 'tfl-hint-data
     :file-name ,file-name
     :alt-names ,alt-names
     :text-id ,text-id
     :voicebox? ,voicebox?
     :interrupt? ,interrupt?
     :repeat? ,repeat?
     :repeat-delay ,repeat-delay
     :task-status ,task-status
     :force-playback? ,force-playback?
     :target-mode ,target-mode
     :close-task ,close-task
     )
  )

(define *tfl-hints* (new 'static 'boxed-array :type tfl-hint-data
                            (new 'static 'tfl-hint-data
                              :file-name "tfl001"
                              :alt-names (new 'static 'boxed-array :type string
                                "tflalt001"
                                "tflalt002"
                                )
                              :text-id (text-id press-to-talk-to-sage)
                              :voicebox? #f
                              :interrupt? #t
                              :repeat? #t
                              :repeat-delay (seconds 120)
                              :task-status (task-status need-resolution)
                              :force-playback? #t
                              :target-mode '()
                              :close-task (game-task none)
                              )
                            (static-hint-data
                              :file-name "JAK070.wav"
                              :text-id (text-id press-to-trade-money-oracle)
                              )
                            (static-hint-data
                              :file-name "JAK071.wav"
                              :text-id (text-id press-to-talk-to-assistant)
                              :task-status (task-status need-resolution)
                              :target-mode '(mode flut)
                              )
                            (static-hint-data
                              :file-name "JAK072.wav"
                              :text-id (text-id press-to-talk-to-sage)
                              :task-status (task-status need-resolution)
                              :target-mode '(mode racer)
                              )
                            (static-hint-data
                              :file-name "DS017.wav"
                              :text-id (text-id press-to-talk)
                              :voicebox? #t
                              :repeat? #t
                              :repeat-delay (seconds 6)
                              :target-mode '(powerup super-eco-red)
                              :force-playback? #t
                              )
                            )
  )
